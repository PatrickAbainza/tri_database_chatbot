# Python Project Template (uv + pytest)

This template provides a basic structure for a Python project using `uv` for environment management and `pytest` for testing, with a focus on Test-Driven Development (TDD).

## Structure

- `src/`: Contains the main source code for your application (e.g., `calculator.py`). This is where your production code lives.
- `tests/`: Contains the tests for your application (e.g., `test_calculator.py`). Tests verify the functionality defined in `src/`.
- `pyproject.toml`: Defines project metadata, dependencies, and tool configurations (like `uv` and `pytest`).
- `.gitignore`: Specifies intentionally untracked files that Git should ignore.
- `.python-version`: Specifies the Python version for tools like `pyenv`.
- `uv.lock`: The lockfile generated by `uv` ensuring deterministic installs.
- `README.md`: This file.

## Getting Started

1.  **Initialize Environment & Install Dependencies:**

    ```bash
    uv sync
    ```

    This command creates a virtual environment (usually `.venv`) if it doesn't exist and installs the dependencies specified in `pyproject.toml` based on `uv.lock`.

2.  **Activate Environment (Optional but Recommended):**

    To use tools like `python` or `pytest` directly without `uv run`, activate the environment:

    ```bash
    # On macOS/Linux (bash/zsh)
    source .venv/bin/activate

    # On Windows (Command Prompt)
    .venv\Scripts\activate.bat

    # On Windows (PowerShell)
    .venv\Scripts\Activate.ps1
    ```

3.  **Run Tests:**

    You can run tests in several ways:

    - **Using the VS Code Task:**
      - Open the Command Palette (Cmd+Shift+P or Ctrl+Shift+P).
      - Type "Tasks: Run Task".
      - Select "Run Python Tests".
    - **Using the Command Line:**

      ```bash
      uv run pytest
      ```

      Or, if the environment is activated:

      ```bash
      pytest
      ```

    - **Running Tests with Coverage:**
      The "Run Python Tests" VS Code task is now configured to generate coverage reports.
      Alternatively, run from the command line:
      ```bash
      uv run pytest --cov=src --cov-report=term-missing --cov-report=xml:coverage.xml
      ```
      This will print a summary to the terminal (`term-missing`) and generate an XML report (`coverage.xml`) suitable for CI systems.

## Development Workflow (TDD Example)

This template encourages a Test-Driven Development approach:

1.  **Write a Failing Test:** Add a new test function to a file in `tests/` (e.g., `tests/test_calculator.py`) for the functionality you want to implement. Run `uv run pytest` and see it fail.

    ```python
    # tests/test_calculator.py
    from src.calculator import subtract # Function doesn't exist yet!

    def test_subtract():
        assert subtract(5, 2) == 3
    ```

2.  **Write Minimal Code to Pass:** Create or modify the corresponding file in `src/` (e.g., `src/calculator.py`) with the simplest code possible to make the new test pass.

    ```python
    # src/calculator.py
    def add(a: int, b: int) -> int:
        return a + b

    def subtract(a: int, b: int) -> int: # New function
        return a - b
    ```

    Run `uv run pytest` again to confirm the test now passes.

3.  **Refactor:** Improve the code in `src/` and `tests/` while ensuring all tests continue to pass.

## Debugging

This template includes VS Code launch configurations (`.vscode/launch.json`) for debugging:

- **Python: Current File:** Debug the currently open Python file.
- **Python: Pytest:** Debug the `pytest` test suite. Set breakpoints in your test files (`tests/`) or source files (`src/`) and launch this configuration.

## Docker Support

This template includes a `Dockerfile` and a `.dockerignore` file to facilitate containerizing the application.

- **`Dockerfile`:** Defines the steps to build a Docker image for the project, including installing `uv`, setting up the environment, copying code, and installing dependencies.
- **`.dockerignore`:** Lists files and directories that should be excluded from the Docker build context to keep the image lean and build times fast.

To build the Docker image:

```bash
docker build -t python-uv-app .
```

To run a container (e.g., starting an interactive bash session):

```bash
docker run -it --rm python-uv-app
```

## Security Scanning

Dependency security scanning is integrated using `pip-audit`:

- **Installation:** `pip-audit` is included as a development dependency in `pyproject.toml`.
- **CI Integration:** The GitHub Actions workflow (`.github/workflows/python-ci.yml`) includes a step to run `uv run pip-audit` after installing dependencies. This automatically checks for known vulnerabilities in the project's dependencies during the CI process.

## Static Code Analysis

This template includes tools for static code analysis to help maintain code quality, identify potential issues, and understand code structure:

- **Ruff:** A fast Python linter and formatter (already configured).
- **Radon:** Calculates various code metrics, including:
  - Cyclomatic Complexity (`cc`): Measures the complexity of functions/methods.
  - Maintainability Index (`mi`): A score indicating ease of maintenance.
- **Copydetect:** Detects duplicated or copied code blocks, which can indicate areas for refactoring.
- **Pydeps:** Analyzes import statements to generate dependency graphs, helping visualize module relationships.

### VS Code Tasks for Analysis

Several VS Code tasks (`.vscode/tasks.json`) are configured to run these tools:

- **`Run Ruff Linter`:** Executes `ruff check .` to find linting errors.
- **`Run Radon Complexity Check`:** Executes `radon cc . -a -s` to show average and detailed cyclomatic complexity.
- **`Run Radon Maintainability Check`:** Executes `radon mi . -s` to show the maintainability index.
- **`Run Copydetect Duplication Check`:** Executes `copydetect .` to find potential code duplication.

Additionally, tasks are available to generate analysis reports in structured formats (useful for CI or further processing):

- **`Python Analysis: Ruff (JSON)`:** Outputs linting results to `analysis_results/ruff_results.json`.
- **`Python Analysis: Radon CC (JSON)`:** Outputs complexity results to `analysis_results/radon_cc_results.json`.
- **`Python Analysis: Copydetect (HTML)`:** Generates an HTML report of duplicated code in `analysis_results/copydetect_report.html`.
- **`Python Analysis: Pydeps (JSON)`:** Outputs dependency information to `analysis_results/pydeps_results.json`.

- **`Run All Python Analyses (JSON/HTML)`:** A convenience task that runs all the JSON/HTML output tasks listed above.

To run any of these tasks, open the Command Palette (Cmd+Shift+P or Ctrl+Shift+P), type "Tasks: Run Task", and select the desired analysis task.

## Recommended VS Code Extensions

This template works well with the following extensions (check `.vscode/extensions.json` for the full list):

- **Python (`ms-python.python`):** Core Python language support.
- **Pylance (`ms-python.vscode-pylance`):** Enhanced IntelliSense, type checking, and code navigation.
- **Ruff (`charliermarsh.ruff`):** Fast Python linter and formatter.

## Logging

For real applications built from this template, using Python's standard `logging` module is recommended for structured and configurable logging.

**Basic Configuration:**

You can set up basic logging quickly:

```python
import logging

logging.basicConfig(level=logging.INFO, format='%(asctime)s - %(name)s - %(levelname)s - %(message)s')
```

**Getting and Using a Logger:**

It's best practice to get a logger instance specific to the module:

```python
logger = logging.getLogger(__name__)

# Example usage
logger.info("This is an informational message.")
logger.warning("This is a warning message.")
logger.error("An error occurred.", exc_info=True) # exc_info=True adds traceback
```

Refer to the [official Python logging documentation](https://docs.python.org/3/library/logging.html) for more advanced configurations, handlers, and formatters.
